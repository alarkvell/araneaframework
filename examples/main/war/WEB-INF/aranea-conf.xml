<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

	<import resource="aranea-filters.xml"/>

  <!-- ########## ARANEA CONFIGURATION ########## -->

  <bean id="applicationRoot" class="org.araneaframework.servlet.core.StandardServletServiceAdapterComponent"
    singleton="false">

    <property name="childService" ref="araneaApplicationFilters"/>
  </bean>
  
	<bean id="araneaApplicationFilters" singleton="false"
		class="org.araneaframework.framework.filter.StandardServiceFilterChainFilterService">
		<property name="childService" ref="araneaTopServiceRouter"/>
		<property name="filterChain">			
			<list>
				<ref bean="araneaCriticalErrorHandler"/>
				<ref bean="araneaReadFileFilter"/>
				<ref bean="araneaMainStatisticFilter"/>
                <ref bean="requestEncodingFilter"/>
                <ref bean="araneaFileUploadFilter"/>
			</list>
		</property>
	</bean>  

  <bean class="org.araneaframework.framework.router.StandardTopServiceRouterService" id="araneaTopServiceRouter"
    singleton="false">
    <property name="defaultServiceId" value="application"/>
    <property name="serviceMap">
      <map>
        <entry key="application" value-ref="araneaSessionRouter"/>
      </map>
    </property>
  </bean>

  <bean class="org.araneaframework.servlet.router.StandardServletSessionRouterService" id="araneaSessionRouter"
        singleton="false">
    <property name="sessionServiceFactory" ref="application.sessionServiceFactory"/>
  </bean>

  <bean class="org.araneaframework.ioc.spring.SpringServiceFactory" id="application.sessionServiceFactory"
        singleton="false">
    <property name="beanId">
      <idref bean="araneaSessionFilters"/>
    </property>
  </bean>
    
  <!-- Session scope -->
  
  <bean id="araneaSessionFilters" singleton="false"
		class="org.araneaframework.framework.filter.StandardServiceFilterChainFilterService">
		<property name="childService" ref="araneaThreadServiceRouter"/>
		<property name="filterChain">			
			<list>
				<!-- <ref bean="araneaSerializingAudit"/>  -->
				<ref bean="araneaLocalizationFilter"/>
				<ref bean="araneaJspConfigFilter"/>
			</list>
		</property>
	</bean>  
  

  <bean class="org.araneaframework.framework.router.StandardThreadServiceRouterService" 
  	id="araneaThreadServiceRouter" singleton="false">
    <property name="defaultServiceId" value="mainThread"/>
    <property name="serviceMap">
      <map>
        <entry key="mainThread" value-ref="araneaThreadFilters"/>
      </map>
    </property>
  </bean>
  
  <!-- Thread scope -->    
  
  <bean id="araneaThreadFilters" singleton="false"
		class="org.araneaframework.framework.filter.StandardServiceFilterChainFilterService">
		<property name="childService" ref="araneaWidgetAdapter"/>
		<property name="filterChain">			
			<list>
				<ref bean="araneaSynchronizingFilter"/>
				<ref bean="araneaContinuationFilter"/>
                <ref bean="responseHeaderFilter"/>
			</list>
		</property>
	</bean>  

  <bean class="org.araneaframework.framework.container.StandardWidgetAdapterService" id="araneaWidgetAdapter"
    singleton="false">
    <property name="childWidget" ref="araneaWidgetFilters"/>
  </bean>
  
   <!-- Framework widgets -->     
   
  <bean id="araneaWidgetFilters" singleton="false"
		class="org.araneaframework.framework.filter.StandardWidgetFilterChainFilterWidget">
		<property name="childWidget" ref="araneaWidgetContainer"/>
		<property name="filterChain">			
			<list>
				<ref bean="araneaTransactionFilter"/>
				<ref bean="araneaMessagingFilter"/>
				<ref bean="araneaContexts"/>
                <bean class="org.araneaframework.servlet.filter.StandardPopupFilterWidget" id="araneaPopupFilter"
                    singleton="false">
                    <property name="serviceFactory">
                        <bean class="org.araneaframework.ioc.spring.EnvironmentAwareSpringServiceFactory" singleton="false">
                            <property name="beanFactoryClass" value="org.springframework.beans.factory.BeanFactory"/>
                            <property name="beanId" value="araneaThreadFilters"/>
                        </bean>
                    </property>
                </bean>
			</list>
		</property>
	</bean>  

  <bean class="org.araneaframework.framework.container.StandardWidgetContainerWidget" id="araneaWidgetContainer"
    singleton="false">
    <property name="childWidget" ref="thread.viewPort"/>
  </bean>

 <!-- Application widgets -->     
  
   <bean class="org.araneaframework.framework.container.StandardViewPortWidget" id="thread.viewPort" singleton="false">
     <property name="root" ref="thread.mainCallStack"/>
   </bean>

   <bean class="org.araneaframework.framework.container.StandardFlowContainerWidget" id="thread.mainCallStack" singleton="false">
     <property name="top" ref="thread.login"/>
   </bean>
   
  <bean class="org.araneaframework.example.main.web.LoginWidget" id="thread.login" singleton="false"/>  
 
</beans>
