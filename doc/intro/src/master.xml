<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.3CR3//EN"
"../../support/docbook-dtd/docbookx.dtd">
<!--
  Copyright 2006 Webmedia Group Ltd.
 
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at
 
   http://www.apache.org/licenses/LICENSE-2.0
 
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<article>
  <articleinfo>
    <title>Introduction to Aranea</title>

    <titleabbrev>Aranea Intro</titleabbrev>

    <authorgroup>
      <author>
        <firstname>Jevgeni</firstname>

        <surname>Kabanov</surname>
      </author>
    </authorgroup>
  </articleinfo>

  <sect1 id="hello-world">
    <title>Hello World</title>

    <para>This example demonstrates the way Aranea applications are assembled
    from independent widgets, the way widgets receive and process events, the
    way the widgets communicate and navigate among each other and how they can
    render themselves. It does not however show numerous other features of
    Aranea frameworks and is simplified as possible to show only relevant core
    properties of Aranea. For a thorough introduction to building applications
    with Aranea see the Business Tutorial.</para>

    <para>As an introduction to Aranea, we present the example that has become
    classical in computer literature for learning new languages and
    technologiesâ€”"Hello World!". Our variant of "Hello World!" will display a
    form where one can insert his name and then display a personalized
    greeting. We will asume that all Java classes in the example are in
    <literal>example</literal> package.</para>

    <figure id="example-hello-name">
      <title>Insert your name display</title>

      <mediaobject>
        <imageobject>
          <imagedata fileref="../images/hello-name-widgets.png" format="PNG" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>As we can see on <xref linkend="example-hello-name" />, we will
    split the example into two separate components (that we refer to hereon as
    widgets). The starting widget is <literal>NameWidget</literal> that has an
    associated <literal>name.jsp</literal> and displays the form for inserting
    your name. The source code of the widget follows:</para>

    <programlisting role="java">public class NameWidget extends BaseUIWidget {
  protected void init() throws Exception {        
    setViewSelector("name");
  }
  
  public void handleEventHello() throws Exception {
    String name = (String) getCurrentInput().getGlobalData().get("name");
    getFlowCtx().replace(new HelloWidget(name), null);
  }  
}</programlisting>

    <para>The first thing of interest is the <literal>init()</literal> method.
    As you could have guessed it is called when the widget is initialized by
    the framework and can be used to perform initialization tasks. In this
    case the widget selects the JSP that will be used for rendering by calling
    the <literal>setViewSelector("name")</literal>, which by default will be
    <literal>/WEB-INF/jsp/name.jsp</literal>:</para>

    <programlisting role="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jsp:root 
  xmlns:jsp="http://java.sun.com/JSP/Page" 
  xmlns:ui="http://araneaframework.org/tag-library/standard" version="1.2"&gt;
  &lt;ui:root&gt;
    &lt;ui:viewPort&gt; 
      &lt;head&gt;
        &lt;ui:importScripts/&gt;           
        &lt;title&gt;Hello World!&lt;/title&gt;
      &lt;/head&gt;                  
      &lt;ui:body&gt;
        
<emphasis role="bold">        &lt;ui:systemForm method="GET"&gt;
            Insert your name: &lt;input type="text" name="name"/&gt;&lt;br/&gt;&lt;br/&gt;            
            &lt;ui:eventButton labelId="#Say hello" eventId="hello"/&gt;      
        &lt;/ui:systemForm&gt;</emphasis>

      &lt;/ui:body&gt;
    &lt;/ui:viewPort&gt;
  &lt;/ui:root&gt;  
&lt;/jsp:root&gt;</programlisting>

    <figure id="example-name-jsp">
      <title>/WEB-INF/jsp/name.jsp</title>

      <programlisting role="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jsp:root 
  xmlns:jsp="http://java.sun.com/JSP/Page" 
  xmlns:ui="http://araneaframework.org/tag-library/standard" version="1.2"&gt;
  &lt;ui:root&gt;
    &lt;ui:viewPort&gt; 
      &lt;head&gt;
        &lt;ui:importScripts/&gt;           
        &lt;title&gt;Hello World!&lt;/title&gt;
      &lt;/head&gt;                  
      &lt;ui:body&gt;
        
        &lt;ui:systemForm method="GET"&gt;
            Insert your name: &lt;input type="text" name="name"/&gt;&lt;br/&gt;&lt;br/&gt;            
            &lt;ui:eventButton labelId="#Say hello" eventId="hello"/&gt;      
        &lt;/ui:systemForm&gt;

      &lt;/ui:body&gt;
    &lt;/ui:viewPort&gt;
  &lt;/ui:root&gt;  
&lt;/jsp:root&gt;</programlisting>
    </figure>

    <para>The only interesting parts are the
    <literal>&lt;ui:systemForm/&gt;</literal> that will render the actual HTML
    form and <literal>&lt;ui:eventButton&gt;</literal> that will render a
    button with a label "Say hello!" that will send the
    <literal>hello</literal> event to the <literal>NameWidget</literal> (which
    will call its <literal>handleEventHello()</literal> method).</para>

    <para>When that will occur the first line of
    <literal>handleEventHello()</literal> method <programlisting role="java">String name = (String) getCurrentInput().getGlobalData().get("name");</programlisting>
    will read the data submitted by the form input field "name". The second
    line of this method <programlisting role="java">getFlowCtx().replace(new HelloWidget(name), null);</programlisting>
    will create a new instance of <literal>HelloWidget</literal> passing it
    the read <literal>name</literal> as a constructor argument. Then we
    replace the current widget in the flow with a new one, which causes the
    <literal>NameWidget</literal> instance to be destroyed and the
    <literal>HelloWidget</literal> instance to become active. The
    <literal>HelloWidget</literal> can be seen on figure <xref
    linkend="example-hello-widget" /></para>

    <figure id="example-hello-widget">
      <title>HelloWidget.java</title>

      <programlisting role="java">public class HelloWidget extends BaseUIWidget {
  private String name;
  
  public HelloWidget(String name) {
    this.name = name;
  }

  protected void init() throws Exception {
    putViewData("name", name);    
    setViewSelector("hello");        
  }
}</programlisting>
    </figure>

    <para><literal>HelloWidget</literal> will save the constructor argument
    and pass it to the view (in our case JSP) using
    <literal>putViewData("name", name);</literal>. It will then delegate
    rendering to the JSP shown on <xref linkend="example-hello-jsp" />.</para>

    <figure id="example-hello-jsp">
      <title>/WEB-INF/jsp/hello.jsp</title>

      <programlisting role="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jsp:root 
  xmlns:jsp="http://java.sun.com/JSP/Page" 
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:ui="http://araneaframework.org/tag-library/standard" version="1.2"&gt;
  &lt;ui:root&gt;
    &lt;ui:viewPort&gt; 
      &lt;ui:widgetContext&gt;
        &lt;head&gt;
          &lt;ui:importScripts/&gt;
              
          &lt;title&gt;Hello World!&lt;/title&gt;
        &lt;/head&gt;     
        
        &lt;ui:body&gt;
          Hello &lt;c:out value="${viewData.name}"/&gt;!
        &lt;/ui:body&gt;
      &lt;/ui:widgetContext&gt;
    &lt;/ui:viewPort&gt;
  &lt;/ui:root&gt;  
&lt;/jsp:root&gt;</programlisting>
    </figure>

    <para>Finally we will need to deploy the example as a web application. The
    simplest way to configure Aranea is to pass the application starting
    widget to its dispatcher servlet.</para>

    <figure id="example-web-xml">
      <title>/WEB-INF/web.xml</title>

      <programlisting role="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE web-app PUBLIC 
  "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN" 
  "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;

&lt;web-app&gt;
  &lt;!-- Aranea session cleanup listener --&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;
      org.araneaframework.http.core.StandardSessionListener
    &lt;/listener-class&gt;
  &lt;/listener&gt;

  &lt;!-- Aranea dispatcher servlet --&gt;
   &lt;servlet&gt;
      &lt;servlet-name&gt;araneaServlet&lt;/servlet-name&gt;
      &lt;servlet-class&gt;
        org.araneaframework.integration.spring.AraneaSpringDispatcherServlet
      &lt;/servlet-class&gt;
      &lt;init-param&gt;
        &lt;param-name&gt;araneaApplicationStart&lt;/param-name&gt;
        &lt;param-value&gt;example.NameWidget&lt;/param-value&gt;
      &lt;/init-param&gt;      
      &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
   &lt;/servlet&gt;
   
   &lt;!-- Aranea dispatcher servlet mapping --&gt;
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;araneaServlet&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/main/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</programlisting>
    </figure>
  </sect1>

  <sect1>
    <title>Flows</title>

    <para></para>
  </sect1>

  <sect1>
    <title>Reusing Widgets</title>

    <para></para>
  </sect1>
</article>