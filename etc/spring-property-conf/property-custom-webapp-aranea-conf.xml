<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <!-- ########## ARANEA CONFIGURATION ########## -->

  <bean id="applicationRoot" class="org.araneaframework.servlet.core.StandardServletServiceAdapterComponent"
    singleton="false">

    <property name="childService" ref="application.readFileFilter"/>
  </bean>
  
  <bean class="org.araneaframework.servlet.filter.StandardServletFileImportFilterService" id="application.readFileFilter"
    singleton="false">
    <property name="childService">
      <ref bean="application.mainStatisticFilter" />
    </property>
  </bean>
  
  <bean class="org.araneaframework.framework.filter.StandardStatisticFilterService"
        id="application.mainStatisticFilter" singleton="false">
    <property name="childService" ref="application.topServiceRouter"/>
    <property name="namespace" value="MAIN"/>
  </bean>

  <bean class="org.araneaframework.framework.router.StandardTopServiceRouterService" id="application.topServiceRouter"
    singleton="false">
    <property name="defaultServiceId" value="application"/>
    <property name="serviceMap">
      <map>
        <entry key="application" value-ref="application.sessionRouter"/>
      </map>
    </property>
  </bean>

  <bean class="org.araneaframework.servlet.router.StandardServletSessionRouterService" id="application.sessionRouter"
        singleton="false">
    <property name="sessionServiceFactory" ref="application.sessionServiceFactory"/>
  </bean>

  <bean class="org.araneaframework.ioc.spring.SpringServiceFactory" id="application.sessionServiceFactory"
        singleton="false">
    <property name="beanId">
      <idref bean="session.serializingAudit"/>
    </property>
  </bean>
  
  <!-- Session scope -->
  
  <bean class="org.araneaframework.framework.filter.StandardSerializingAuditFilterService" id="session.serializingAudit"
        singleton="false">
    <property name="childService" ref="session.localizationFilter"/>     
  </bean> 
  
  <bean class="org.araneaframework.framework.filter.StandardLocalizationFilterService" id="session.localizationFilter" singleton="false">
    <property name="childService" ref="session.jspConfigFilter"/>
    <property name="resourceBundleName" value="${l10n.resourceBundle}"/>
    <property name="languageName" value="${l10n.defaultLocale}"/>
  </bean>        

  <bean class="org.araneaframework.servlet.filter.StandardJspFilterService" id="session.jspConfigFilter" singleton="false">
    <property name="childService" ref="session.threadServiceRouter"/>
    <property name="submitCharset" value="${l10n.encoding}"/>
    <property name="jspPath" value="${jsp.path}"/>        
  </bean>

  <bean class="org.araneaframework.framework.router.StandardThreadServiceRouterService" id="session.threadServiceRouter" 
    singleton="false">
    <property name="defaultServiceId" value="mainThread"/>
    <property name="serviceMap">
      <map>
        <entry key="mainThread" value-ref="thread.synchronizingFilter"/>
      </map>
    </property>
  </bean>
  
  <!-- Thread scope -->    

  <bean class="org.araneaframework.framework.filter.StandardSynchronizingFilterService" id="thread.synchronizingFilter"
    singleton="false">
    <property name="childService" ref="thread.headerFilter"/>
  </bean>
  
  <bean class="org.araneaframework.servlet.filter.StandardServletHttpFilterService" id="thread.headerFilter"
    singleton="false">
    <property name="childService" ref="thread.fileUploadFilter"/>
    <property name="requestEncoding" value="${l10n.encoding}"/>
  </bean>
  
  <bean class="org.araneaframework.servlet.filter.StandardServletFileUploadFilterService" id="thread.fileUploadFilter"
    singleton="false">
    <property name="childService">
      <ref bean="thread.continuationFilter" />
    </property>
  </bean>
  
 <bean class="org.araneaframework.framework.filter.StandardContinuationFilterService" id="thread.continuationFilter"
    singleton="false">
    <property name="childService">
      <ref bean="thread.widgetAdapter" />
    </property>
  </bean>

  <bean class="org.araneaframework.framework.container.StandardWidgetAdapterService" id="thread.widgetAdapter"
    singleton="false">
    <property name="childWidget" ref="thread.transactionFilter"/>
  </bean>
  
   <!-- Framework widgets -->     

  <bean class="org.araneaframework.framework.filter.StandardTransactionFilterWidget" id="thread.transactionFilter"
    singleton="false">
    <property name="childWidget" ref="thread.messagingFilter"/>
  </bean>
  
  <bean class="org.araneaframework.framework.filter.StandardMessagingFilterWidget" id="thread.messagingFilter"
    singleton="false">
    <property name="childWidget" ref="thread.contexts"/>
  </bean>

  <bean class="org.araneaframework.framework.filter.StandardContextMapFilterWidget" id="thread.contexts"
    singleton="false">
    <property name="childWidget" ref="thread.popupFilter"/>
    <property name="contexts">    
      <map>
        <entry 
          key="org.araneaframework.uilib.ConfigurationContext.class" 
          value-ref="${configuration}"/>   
      </map>      
    </property>    
  </bean>
  
  <bean class="org.araneaframework.servlet.filter.StandardPopupFilterWidget" id="thread.popupFilter"
     singleton="false">
    <property name="childWidget" ref="thread.widgetContainer"/>
  </bean>

  <bean class="org.araneaframework.framework.container.StandardWidgetContainerWidget" id="thread.widgetContainer"
    singleton="false">
    <property name="childWidget" ref="thread.viewPort"/>
  </bean>

 <!-- Application widgets -->     
  
   <bean class="org.araneaframework.framework.container.StandardViewPortWidget" id="thread.viewPort" singleton="false">
     <property name="root" ref="thread.mainCallStack"/>
   </bean>

   <bean class="org.araneaframework.framework.container.StandardFlowContainerWidget" id="thread.mainCallStack" singleton="false">
     <property name="top" ref="araneaApplicationStart"/>
   </bean>
   
 <!-- Separate beans -->   
	
  <bean id="araneaDefaultConfiguration" class="org.araneaframework.uilib.core.DefaultConfiguration" singleton="false"/>
  
</beans>
